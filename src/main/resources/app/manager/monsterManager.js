define("jquery underscore app/utils/utils app/manager/etatsManager app/data/glossaire app/data/suffixe app/data/items app/data/etats".split(" "),function(s,y,e,t,u,r,h,z){return function(v,w,x){this.init=function(a,c,b){this.el="";this.parent=a;this.Textes=a.Textes;this.saveManager=a.saveManager;this.mediatheque=a.mediatheque;this.index=b;this.name=null==c.name?c:c.name;this.template=u.get(this.name);this.suffixe=c.suffixe?r.get(c.suffixe):r.getRandom();a=this.parent.player.get("level");b=a-1;var d=
a+1;this.template.level&&(b=eval(this.template.level[0].replace("player",a)),d=eval(this.template.level[1].replace("player",a)));c.levelMin&&(b=eval(c.levelMin.replace("player",a)));c.levelMax&&(d=eval(c.levelMax.replace("player",a)));this.level=e.rand(b,d,!0);c.level&&(this.level=eval(c.level.replace("player",a)));0>this.level&&(this.level=0);a=e.rand(this.template.vie[0]*this.suffixe.vie*((this.level+2)/2),this.template.vie[1]*this.suffixe.vie*((this.level+2)/2));1>a&&(a=1);b=e.rand((this.template.mana[0]+
this.level)*this.suffixe.mana,(this.template.mana[1]+this.level)*this.suffixe.mana);var d=(this.template.attaque[0]+this.level)*this.suffixe.attaque,f=(this.template.attaque[1]+this.level)*this.suffixe.attaque;1>f&&(f=1);var g=(this.template.defense[0]+this.level)*this.suffixe.defense,l=(this.template.defense[1]+this.level)*this.suffixe.defense,h=e.rand((this.template.argent[0]+this.level)*this.suffixe.argent,(this.template.argent[1]+this.level)*this.suffixe.argent);1>h&&(h=1);var m=e.rand((this.template.xp[0]+
this.level)*this.suffixe.xp,(this.template.xp[1]+this.level)*this.suffixe.xp);1>m&&(m=1);var n=[];c.abilities?n=c.abilities:this.template.abilities&&(n=this.template.abilities);c=[];if(this.template.consos)for(var k in this.template.consos)c.push(this.template.consos[k]);this.type=this.template.type;k=25;this.template.spellChances&&(k=this.template.spellChances);var p=5;this.template.itemsChances&&(p=this.template.itemsChances);var q=100-k-p;0>q&&(q=0);this.isMonster=!0;this.data={life:{current:a,
max:a},mana:{current:b,max:b},attaque:[d,f],defense:[g,l],gold:h,xp:m,abilities:n,consos:c,buff:null,debuff:null,level:this.level,spellChances:k,itemsChances:p,attaqueChances:q};this.etatsManager=new t(this)};this.get=function(a){a=a.split(".");var c=this.data,b;for(b in a)if(c=c[a[b]],void 0==c)return null;return c};this.completeName=function(){var a=this.suffixe.namef;"m"==this.template.sexe&&(a=this.suffixe.namem);return this.suffixe.noname?this.Textes.get(a):"fr"==this.Textes.local?this.Textes.get(this.name)+
"\x3cbr/\x3e"+this.Textes.get(a):this.Textes.get(a)+"\x3cbr/\x3e"+this.Textes.get(this.name)};this.removeConso=function(a){var c=this.data.consos.indexOf(a);-1<c?this.data.consos.splice(c,1):console.log("Erreur suppression - conso non possédé",a)};this.attaque=function(a,c){var b=this.data.attaque,b=e.rand(b[0],b[1],!0);0>b&&(b=0);return a.hurt(b,c)};this.hurt=function(a,c,b){c&&(c=this.data.defense,c=e.rand(c[0],c[1],!0),a-=c);0>a&&(a=0);this.addLife(-a,b);return a};this.addPercentLife=function(a,
c){a=Math.ceil(e.percent(this.data.life.max,a));this.addLife(a,c)};this.addLife=function(a,c){this.data.life.current+=a;if(0>=this.data.life.current&&(this.data.life.current=0,this.template.dieSound)){var b=this;e.then(function(){b.mediatheque.playSound(b.template.dieSound+".wav")},100)}this.data.life.current>this.data.life.max&&(this.data.life.current=this.data.life.max)};this.has=function(a){return e.contains(this.data.consos,a)?"conso":e.contains(this.data.abilities,a)?"abilities":null};this.use=
function(a,c){c||(c=this);Array.isArray(c)||(c=[c]);if(e.contains(this.data.consos,a)){var b=h.get("conso",a),d;for(d in c){var f=c[d];f.addAmountChange(this.Textes.get(b.name),"abilitie",b.element);if(b.degats){var g=this.data.attaque,g=e.rand(g+b.degats[0],g+b.degats[1],!0);0<g&&f.hurt(g,!0)}b.vie&&(g=e.rand(b.vie[0],b.vie[1],!0),0<g&&f.addPercentLife(g));b.mana&&(g=e.rand(b.mana[0],b.mana[1],!0),0<g&&f.addPercentMana(g));if(b.effet)for(d in b.effet)this.etatsManager.check(b.effet[d],f);b.action&&
b.action(this,f,this.fightView)}b.sound&&this.mediatheque.playSound(b.sound+".wav");this.removeConso(a);return!0}console.log("Erreur use - objet non possédé",a,c);return!1};this.spell=function(a,c){c||(c=this);Array.isArray(c)||(c=[c]);var b=!1;if(e.contains(this.data.abilities,a)){var d=h.get("magie",a);if(d.contrainte&&!d.contrainte(this,g,this.parent))return b;if(d.manaCost<=this.get("mana.current")){this.addMana(-d.manaCost);for(var f in c){var g=c[f];g.addAmountChange(this.Textes.get(d.name),
"abilitie",d.element);b=0;d.degats&&(b=this.data.attaque,b=e.rand(d.degats[0]+b[0],d.degats[1]+b[1],!0),0<b&&g.hurt(b,!0,d.element));if(d.lifeSteal){var l=e.rand(d.lifeSteal[0],d.lifeSteal[1],!0);this.stealLife(l,b,g)}d.vie&&(b=e.rand(d.vie[0],d.vie[1],!0),0<b&&g.addPercentLife(b));d.manaSteal&&(b=e.rand(d.manaSteal[0],d.manaSteal[1],!0),this.stealMana(b,g));d.action&&d.action(this,g,this.parent);if(d.effet)for(f in d.effet)this.etatsManager.check(d.effet[f],g)}b=!0;d.sound&&this.mediatheque.playSound(d.sound+
".wav")}else console.log("Erreur monster spell - pas assez de mana",d,c)}else console.log("Erreur monster spell - sort non possédé",a,c);return b};this.addPercentMana=function(a){a=Math.round(e.percent(this.data.mana.max,a));this.addMana(a)};this.addMana=function(a){this.data.mana.current+=a;0>this.data.mana.current&&(this.data.mana.current=0);this.data.mana.current>this.data.mana.max&&(this.data.mana.current=this.data.mana.max)};this.usableMagie=function(){if(!this.data.mana.current)return[];var a=
[],c=this.data.mana.current,b;for(b in this.data.abilities){var d=this.data.abilities[b],e=h.get("magie",d);c>=e.manaCost&&a.push(d)}return a};this.stealMana=function(a,c){var b=c.get("mana.current"),b=Math.round(e.percent(b,a));0<b&&this.steal("mana",c,b)};this.stealLife=function(a,c,b){var d=b.get("life.current"),f=0;c?(f=Math.round(e.percent(c,a)),0<f&&this.addLife(f)):(f=Math.round(e.percent(d,a)),0<f&&this.steal("life",b,f))};this.steal=function(a,c,b,d){switch(a){case "life":a=c.get("life.current");
c.addLife(-b);a-=c.get("life.current");void 0!=d?this.addLife(e.rand(d,a,!0)):this.addLife(a);break;case "mana":a=c.get("mana.current");c.addMana(-b);a-=c.get("mana.current");void 0!=d?this.addMana(e.rand(d,a,!0)):this.addMana(a);break;case "gold":a=c.get("gold"),c.addGold(-b),a-=c.get("gold"),c.addAmountChange&&c.addAmountChange(a,"gold"),void 0!=d?this.addGold(e.rand(d,a,!0)):this.addGold(a)}};this.addGold=function(a){this.data.gold+=a;0>this.data.gold&&(this.data.gold=0);this.data.gold>e.MAX_GOLD&&
(this.data.gold=e.MAX_GOLD)};this.launchAttaque=function(a,c,b,d){a=e.rand(0,100);var f=100-this.data.itemsChances,g=f-this.data.spellChances,h=!1;this.template.action&&(h=this.template.action(this));h||(a>=f?h=this.launchUse(c,b):a>=g&&(h=this.launchSpell(c,b)));h||(this.attaque(c,!0)?this.mediatheque.playSound("hurt.wav"):(d||(d="block"),this.mediatheque.playSound(d+".wav")));this.etatsManager.infligeEtats()};this.launchSpell=function(a,c){var b=!1,d=this.usableMagie();0<d.length&&(b=d[e.rand(0,
d.length)],b=h.get("magie",b),b.offensif?b=this.spell(b.name,a):b.multicible?b=this.spell(b.name,c):(d=c[e.rand(0,c.length)],b=this.spell(b.name,d)));return b};this.launchUse=function(a,c){var b=!1,d=this.data.consos;0<d.length&&(b=d[e.rand(0,d.length)],b=h.get("conso",b),b.offensif?b=this.use(b.name,a):d.multicible?b=this.use(b.name,c):(d=c[e.rand(0,c.length)],b=this.use(b.name,d)));return b};this.showDegats=function(a){if(a){var c=s(".fight monster#"+this.index+" anim");c.addClass(a);c.fadeIn(200,
function(){c.fadeOut(500,function(){c.removeClass(a)})})}};this.addAmountChange=function(a,c,b){this.parent.player.addAmountChange(a,c,b)};this.restore=function(){this.data.debuff=null;this.data.buff=null;this.addLife(this.get("life.max"));this.addMana(this.get("mana.max"))};this.init(v,w,x)}});