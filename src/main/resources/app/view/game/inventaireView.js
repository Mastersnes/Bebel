define("jquery underscore app/utils/utils app/utils/map app/utils/viewUtils text!app/template/game/inventaire.html app/data/items".split(" "),function(b,h,g,k,n,l,d){return function(m){this.init=function(a){this.el=b(".inventaire");this.parent=a;this.Textes=a.Textes;this.mediatheque=a.mediatheque;this.kongregateUtils=a.kongregateUtils;this.saveManager=a.saveManager;this.recompenseManager=a.recompenseManager;this.player=a.playerManager;this.inventaireOpen=!1;this.el.hide()};this.initConsos=function(){this.consos=
new k;var a=this.player.get("equipment.conso"),c;for(c in a){var e=a[c],b=this.consos.get(e);b?b++:b=1;this.consos.put(e,b)}};this.render=function(){h.templateSettings.variable="data";var a=h.template(l);this.el.html(a({text:this.Textes,player:this.player,consos:this.consos}));this.makeEvents()};this.show=function(a,c){this.inventaireOpen=!0;this.initConsos();this.player.arme();this.player.bouclier();this.render();this.el.fadeIn();this.refreshStats()};this.refreshStats=function(){this.refreshInfo(this.player.get("life").current,
"life");this.refreshEtat(this.player.get("debuff"),"debuff");this.refreshEtat(this.player.get("buff"),"buff");this.refreshInfo(this.player.get("mana").current,"mana",this.player.get("unlockMana"));var a=this.player.arme();this.refreshInfo(a.degats[0]+"-"+a.degats[1],"arme");var c;if(a.lifeSteal){var b=this.player.get("attaque");c=Math.round(g.percent(b+a.degats[0],a.lifeSteal[0]));b=Math.round(g.percent(b+a.degats[1],a.lifeSteal[1]));c=c+"-"+b}this.refreshInfo(c,"lifeSteal");var f;a.manaSteal&&(f=
a.manaSteal[0]+"-"+a.manaSteal[1]+"%");this.refreshInfo(f,"manaSteal");a=this.player.bouclier();this.refreshInfo(a.defense[0]+"-"+a.defense[1],"bouclier")};this.refreshInfo=function(a,c,b){void 0==b&&(b=void 0!=a);c=this.el.find("profil info."+c);b?(c.show(),c.find("span").html(a)):c.hide()};this.refreshEtat=function(a,c){var b=this.el.find("profil info."+c);if(a){b.show();var f;if(a.offensif)f=a.degats[0]+"-"+a.degats[1];else{var d=this.player.get("life").max;f=Math.round(g.percent(d,a.vie[0]));
d=Math.round(g.percent(d,a.vie[1]));f=f+"-"+d}b.find("span.amount").html(f);b.find("span.duree").html(a.current)}else b.hide()};this.loop=function(){this.inventaireOpen&&(b("carnet").hasClass("hide")||b("carnet").addClass("hide"))};this.refreshConso=function(a){var c=this.Textes.get(a.attr("id")),b=parseInt(a.attr("nb"));1==b?a.html(c):a.html(c+"(x"+b+")")};this.refreshMagie=function(a){var b=a.attr("id"),b=d.get("magie",b),e=this.player.get("mana.current");a.removeClass("clickable");a.removeClass("interdit");
b.offensif||(b.manaCost<=e?a.addClass("clickable"):a.addClass("interdit"))};this.makeEvents=function(){var a=this;this.el.find("armes element").click(function(){var c=b(this).find("case");c.hasClass("coche")||(a.el.find("armes case").removeClass("coche"),c.addClass("coche"),a.player.selectArme(b(this).attr("id")),a.refreshStats())});this.el.find("boucliers element").click(function(){var c=b(this).find("case");c.hasClass("coche")||(a.el.find("boucliers case").removeClass("coche"),c.addClass("coche"),
a.player.selectBouclier(b(this).attr("id")),a.refreshStats())});this.el.find("magies element").hover(function(){a.refreshMagie(b(this))},function(){b(this).removeClass("clickable");b(this).removeClass("interdit")});this.el.find("consos element").hover(function(){var a=b(this).attr("id"),a=d.get("conso",a);b(this).html();b(this).removeClass("clickable");a.offensif||b(this).addClass("clickable")},function(){b(this).removeClass("clickable")});this.el.find("magies element").click(function(){var c=b(this).attr("id");
d.get("magie",c).offensif||(a.player.spell(c),a.player.etatsManager.infligeEtats(),a.refreshStats(),a.refreshMagie(b(this)))});this.el.find("consos element").click(function(){var c=b(this).attr("id");if(!d.get("conso",c).offensif){a.player.use(c,null);var e=a.consos.get(c)-1;0>=e?(a.consos.remove(c),b(this).remove()):(a.consos.put(c,e),b(this).attr("nb",e),a.refreshConso(b(this)));a.player.etatsManager.infligeEtats();a.refreshStats()}});this.el.find(".canClose").click(function(c){b(c.target).hasClass("canClose")&&
(a.inventaireOpen=!1,b("carnet").removeClass("hide"),a.el.fadeOut())})};this.init(m)}});