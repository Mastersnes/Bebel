define(["jquery","app/utils/utils"],function(e,c){return function(){this.sounds=[];this.callbacks=[];this.soundsTicker=[];this.listStories=["music/story1.mp3","music/story2.mp3","music/story3.mp3"];this.loadAll=function(){var a=this.listStories,b;for(b in a)this.load(a[b]);this.isMuteMusic=window.localStorage.getItem(c.name+"Music");this.isMuteMusic&&"false"!=this.isMuteMusic||(this.isMuteMusic=!1);this.isMuteSound=window.localStorage.getItem(c.name+"Sound");this.isMuteSound&&"false"!=this.isMuteSound||
(this.isMuteSound=!1)};this.load=function(a,b,c){b||(b="");var d=this.sounds[a+b];d||(d=window.Audio?new Audio("app/"+a):new HTMLAudioElement("app/"+a),d.volume=1);-1<a.indexOf("music")&&(this.callbacks[a+b]&&d.removeEventListener("ended",this.callbacks[a+b]),this.callbacks[a+b]=function(){this.currentTime=0;c?c():this.play()},d.addEventListener("ended",this.callbacks[a+b],!1));d.load();this.sounds[a+b]=d};this.play=function(a,b,c){if(a){b||(b="");this.load(a,b,c);try{if(-1<a.indexOf("music")){this.currentMusic=
a;if(this.isMuteMusic)return;this.stopAllMusic()}-1<a.indexOf("music")&&0<this.sounds[a+b].duration&&!this.sounds[a+b].paused||this.sounds[a+b].play()}catch(d){this.load(a,b)}}};this.playSound=function(a){a&&!this.isMuteSound&&(void 0==this.soundsTicker[a]&&(this.soundsTicker[a]=0),this.play("sounds/"+a,this.soundsTicker[a]++),3<this.soundsTicker[a]&&(this.soundsTicker[a]=0))};this.stopSound=function(a){a&&this.stop("sounds/"+a)};this.stop=function(a){if(a)try{this.sounds[a].pause(),this.sounds[a].currentTime=
0}catch(b){}};this.stopAllMusic=function(){for(var a in this.sounds)-1<a.indexOf("music")&&this.stop(a)};this.mute=function(a){var b=this.isMuteMusic;switch(a){case "all":a=this.isMuteMusic&&this.isMuteSound;this.isMuteMusic=!a;this.isMuteSound=!a;break;case "music":this.isMuteMusic=!this.isMuteMusic;break;case "sound":this.isMuteSound=!this.isMuteSound}window.localStorage.setItem(c.name+"Music",this.isMuteMusic);window.localStorage.setItem(c.name+"Sound",this.isMuteSound);b!=this.isMuteMusic&&(this.isMuteMusic?
this.stopAllMusic():this.play(this.currentMusic))};this.isMute=function(a){switch(a){case "all":return this.isMuteMusic&&this.isMuteSound;case "music":return this.isMuteMusic;case "sound":return this.isMuteSound}}}});