define("jquery underscore app/utils/utils app/utils/viewUtils app/utils/map text!app/template/game/boutique.html app/data/items".split(" "),function(e,f,n,h,k,l,g){return function(m){this.init=function(a){this.el=e(".boutique");this.parent=a;this.Textes=a.Textes;this.mediatheque=a.mediatheque;this.kongregateUtils=a.kongregateUtils;this.saveManager=a.saveManager;this.recompenseManager=a.recompenseManager;this.player=a.playerManager;this.itemsAvailable=[];this.items=new k;this.purchase=[];this.boutiqueOpen=
!1;this.el.hide()};this.open=function(a,b,c){this.boutiqueOpen=!0;e(".histoire").fadeOut();e(".fight").fadeOut();e(".jeuGarde").fadeOut();e(".quetes").fadeOut();this.onPurchase=b;this.onNoPurchase=c;this.itemsAvailable=a;this.purchase=[];this.acheter()};this.acheter=function(){this.items.clear();for(var a in this.itemsAvailable){var b=this.itemsAvailable[a];this.items.put(b,g.get(b))}this.render("achat");this.el.fadeIn()};this.vendre=function(){this.items.clear();this.addItemsVente(this.player.get("equipment.arme"));
this.addItemsVente(this.player.get("equipment.bouclier"));this.addItemsVente(this.player.get("equipment.magie"));this.addItemsVente(this.player.get("equipment.conso"));this.render("vente");this.refresh();this.el.fadeIn()};this.addItemsVente=function(a){for(var b in a){var c=a[b],d=this.items.get(c);d?(d.nb++,this.items.put(c,d)):(d=g.get(c),d.price&&(d.price=Math.round(0.5*d.price),d.nb=1,this.items.put(c,d)))}};this.render=function(a){this.mode=a;var b=this;f.templateSettings.variable="data";a=f.template(l);
this.el.html(a({text:this.Textes,mode:this.mode,items:this.items}));h.verticalCenter();setTimeout(function(){b.showActions()},50);this.makeEvents()};this.loop=function(){this.boutiqueOpen&&(e("carnet").hasClass("hide")||e("carnet").addClass("hide"))};this.refresh=function(){this.boutiqueOpen&&(this.mode="vente",0==this.el.find(".itemsContainer actions").children().length?(this.el.find(".itemsContainer").hide(),this.el.find("storyContainer").show()):(this.el.find(".itemsContainer").show(),this.el.find("storyContainer").hide()))};
this.sellAndRefresh=function(a){var b=this.items.get(a);b.nb--;var c=this.el.find(".itemsContainer #"+a);0>=b.nb?(this.items.remove(a),c.remove()):(this.items.put(a,b),c.find("quantity amount").html("x"+b.nb),1==b.nb&&c.find("quantity amount").hide());this.refresh()};this.makeEvents=function(){var a=this;this.el.find("#acheter").click(function(){a.hideActions(function(){a.acheter()})});this.el.find("#vendre").click(function(){a.hideActions(function(){a.vendre()})});this.el.find("#quitter").click(function(){a.hideActions(function(){a.close()})});
this.el.find(".itemsContainer action").click(function(){var b=e(this).attr("id"),c=!1;"achat"==a.mode?c=a.player.achete(b):a.player.vend(b)&&(c=!0,a.sellAndRefresh(b));c&&a.purchase.push(b)})};this.showActions=function(a){var b=this;this.el.find("action").css({top:"0%"});setTimeout(function(){b.el.find(".itemsContainer").css("overflow","auto");a&&a()},300)};this.hideActions=function(a){this.el.find(".itemsContainer").removeAttr("style");this.el.find("action").css({top:"150%"});setTimeout(a,300)};
this.close=function(){this.boutiqueOpen=!1;if(this.onNoPurchase&&0==this.purchase.length)this.onNoPurchase();else this.onPurchase()};this.init(m)}});